#!/usr/bin/make -f

# clean build from git (including .orig.tar.gz if non-existent):
# $ git-buildpackage --git-upstream-branch=master --git-debian-branch=debian --git-upstream-tree=branch

DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/buildflags.mk

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/mozilla-devscripts/xpi.mk

export VERSION := $(DEB_UPSTREAM_VERSION)
export XUL_CFLAGS := -I/usr/include/firefox -I/usr/include/firefox/nspr
export XUL_LDFLAGS := -L/usr/lib/firefox-devel/lib -lxpcomglue_s -lxul -lxpcom \
    -lmozalloc -lplds4 -lplc4 -lnspr4 -lpthread -ldl
export XPCOM_ABI_FLAGS=-Wl,-rpath=/usr/lib/firefox/


# Use this when #688438 is fixed, and get rid of Makefile.combined
#MOZ_XPI_BUILD_COMMAND = make
#MOZ_XPI_CLEAN_COMMAND = make clean

MOZ_XPI_BUILD_COMMAND = make -C debian -f Makefile.combined all
MOZ_XPI_CLEAN_COMMAND = make -C debian -f Makefile.combined clean-all
